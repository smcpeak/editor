// lsp-set-document-type.ev
// Test changing the document type.
{
  args: ["test/language-test.cc"]
  cmds: [

CheckFocusWidget("window1.frame1.editorFrame.m_editorWidget")
CheckQuery("window1.frame1.editorFrame.m_editorWidget" "documentFileName" "language-test.cc")
CheckQuery("window1.frame1.editorFrame.m_editorWidget" "documentType" "C++")

// Status widget indicates not started.
CheckLabel("window1.m_statusArea.m_lspStatusWidget" "_")

// Start LSP.
CheckQuery("window1.frame1.editorFrame.m_editorWidget" "lspIsFakeServer" true)
Shortcut("window1.m_menuBar" "Alt+L")
KeyPress("window1.m_menuBar.lspMenu" "Key_A" "a")

// Status should change to "-".
WaitUntilCheckLabel(2000 "window1.m_statusArea.m_lspStatusWidget" "-")
CheckQuery("window1.frame1.editorFrame.m_editorWidget" "lspNumDiagnostics" null)

// Open the file.
Shortcut("window1.m_menuBar.lspMenu.lspOpenOrUpdateFile" "F7")

// Status widget should change to 2.
WaitUntilCheckLabel(2000 "window1.m_statusArea.m_lspStatusWidget" "2")
CheckQuery("window1.frame1.editorFrame.m_editorWidget" "lspNumDiagnostics" 2)

// Change the document type to "Plain text".
Shortcut("window1.m_menuBar" "Alt+F")
KeyPress("window1.m_menuBar.fileMenu" "Key_D" "d")
KeyPress("window1.m_menuBar.fileMenu" "Key_T" "t")
CheckFocusWidget("window1.chooseDocumentType.#4")
FocusKeyPR("Key_Up" "")
FocusKeyPR("Key_Up" "")
FocusKeyPR("Key_Return" "\r")

// Back in editor.
CheckFocusWidget("window1.frame1.editorFrame.m_editorWidget")

// Document type was changed.
CheckQuery("window1.frame1.editorFrame.m_editorWidget" "documentType" "Plain text")

// LSP status should reflect there being no server and no diagnostics.
CheckLabel("window1.m_statusArea.m_lspStatusWidget" "_")
CheckQuery("window1.frame1.editorFrame.m_editorWidget" "lspNumDiagnostics" null)

// Change the type back to "C++".
Shortcut("window1.m_menuBar" "Alt+F")
KeyPress("window1.m_menuBar.fileMenu" "Key_D" "d")
KeyPress("window1.m_menuBar.fileMenu" "Key_T" "t")
CheckFocusWidget("window1.chooseDocumentType.#4")
FocusKeyPR("Key_Down" "")
FocusKeyPR("Key_Down" "")
FocusKeyPR("Key_Return" "\r")

// Back in editor.
CheckFocusWidget("window1.frame1.editorFrame.m_editorWidget")

// Document type was changed.
CheckQuery("window1.frame1.editorFrame.m_editorWidget" "documentType" "C++")

// LSP status should reflect there *is* a server.
CheckLabel("window1.m_statusArea.m_lspStatusWidget" "-")

// But there are no diagnostics.
CheckQuery("window1.frame1.editorFrame.m_editorWidget" "lspNumDiagnostics" null)

// Open the file again.
Shortcut("window1.m_menuBar.lspMenu.lspOpenOrUpdateFile" "F7")

// Status widget should change to 2.
WaitUntilCheckLabel(2000 "window1.m_statusArea.m_lspStatusWidget" "2")
CheckQuery("window1.frame1.editorFrame.m_editorWidget" "lspNumDiagnostics" 2)

]}
// EOF
