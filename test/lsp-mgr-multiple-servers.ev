// lsp-mgr-multiple-servers.ev
// Demonstrate the LSP Servers dialog with multiple servers.

// Expected command line args:
// test/language-test.cc lsp-test-server.py smbase/create-tuple-class.py

// In editor with right file open.
CheckFocusWidget("window1.frame1.editorFrame.m_editorWidget")
CheckQuery("window1.frame1.editorFrame.m_editorWidget" "documentFileName" "create-tuple-class.py")

// Start LSP #1 (Python in smbase directory).
Shortcut("window1.m_menuBar" "Alt+L")
KeyPress("window1.m_menuBar.lspMenu" "Key_A" "a")
CheckFocusWidget("window1.frame1.editorFrame.m_editorWidget")
WaitUntilCheckLabel(2000 "window1.m_statusArea.m_lspStatusWidget" "-")

// Open the file.
Shortcut("window1.m_menuBar.lspMenu.lspOpenOrUpdateFile" "F7")
WaitUntilCheckLabel(2000 "window1.m_statusArea.m_lspStatusWidget" "0")

// Switch to "lsp-test-server.py".
Shortcut("window1.m_menuBar.windowMenu.windowOpenFilesList" "Ctrl+O")
CheckFocusWidget("OpenFilesDialog.m_tableWidget")
FocusKeyPR("Key_Down" "")
FocusKeyPR("Key_Return" "\r")
CheckFocusWidget("window1.frame1.editorFrame.m_editorWidget")
CheckQuery("window1.frame1.editorFrame.m_editorWidget" "documentFileName" "lsp-test-server.py")

// Start LSP #2 (Python in editor directory).
Shortcut("window1.m_menuBar" "Alt+L")
KeyPress("window1.m_menuBar.lspMenu" "Key_A" "a")
CheckFocusWidget("window1.frame1.editorFrame.m_editorWidget")
WaitUntilCheckLabel(2000 "window1.m_statusArea.m_lspStatusWidget" "-")

// Here, we do not open the file.

// Switch to "language-test.cc".
Shortcut("window1.m_menuBar.windowMenu.windowOpenFilesList" "Ctrl+O")
CheckFocusWidget("OpenFilesDialog.m_tableWidget")
FocusKeyPR("Key_Down" "")
FocusKeyPR("Key_Down" "")
FocusKeyPR("Key_Return" "\r")
CheckFocusWidget("window1.frame1.editorFrame.m_editorWidget")
CheckQuery("window1.frame1.editorFrame.m_editorWidget" "documentFileName" "language-test.cc")

// Start LSP #3 (C++).
Shortcut("window1.m_menuBar" "Alt+L")
KeyPress("window1.m_menuBar.lspMenu" "Key_A" "a")
CheckFocusWidget("window1.frame1.editorFrame.m_editorWidget")
WaitUntilCheckLabel(2000 "window1.m_statusArea.m_lspStatusWidget" "-")

// Open the file.
Shortcut("window1.m_menuBar.lspMenu.lspOpenOrUpdateFile" "F7")
WaitUntilCheckLabel(2000 "window1.m_statusArea.m_lspStatusWidget" "2")

// Open the dialog.
Shortcut("window1.m_menuBar" "Alt+L")
KeyPress("window1.m_menuBar.lspMenu" "Key_M" "m")
CheckFocusWidget("LSPServersDialog.m_table")

// Check the table.
CheckTableWidgetContents("LSPServersDialog.m_table" [
  ["local" "N/A" "C++" "1" "LSP_PS_NORMAL"]
  ["local" re("editor/") "Python" "0" "LSP_PS_NORMAL"]
  ["local" re("editor/smbase/") "Python" "1" "LSP_PS_NORMAL"]
])

// Close the dialog.
FocusKeyPR("Key_Escape" "\u{1B}")
CheckFocusWidget("window1.frame1.editorFrame.m_editorWidget")

// Stop LSP #3.
Shortcut("window1.m_menuBar" "Alt+L")
KeyPress("window1.m_menuBar.lspMenu" "Key_P" "p")
CheckFocusWidget("window1.frame1.editorFrame.m_editorWidget")
WaitUntilCheckLabel(2000 "window1.m_statusArea.m_lspStatusWidget" "_")

// Switch to lsp-test-server.py.
Shortcut("window1.m_menuBar.windowMenu.windowOpenFilesList" "Ctrl+O")
CheckFocusWidget("OpenFilesDialog.m_tableWidget")
FocusKeyPR("Key_Down" "")
FocusKeyPR("Key_Return" "\r")
CheckFocusWidget("window1.frame1.editorFrame.m_editorWidget")
CheckQuery("window1.frame1.editorFrame.m_editorWidget" "documentFileName" "lsp-test-server.py")

// Stop LSP #2.
Shortcut("window1.m_menuBar" "Alt+L")
KeyPress("window1.m_menuBar.lspMenu" "Key_P" "p")
CheckFocusWidget("window1.frame1.editorFrame.m_editorWidget")
WaitUntilCheckLabel(2000 "window1.m_statusArea.m_lspStatusWidget" "_")

// Switch to create-tuple-class.py.
Shortcut("window1.m_menuBar.windowMenu.windowOpenFilesList" "Ctrl+O")
CheckFocusWidget("OpenFilesDialog.m_tableWidget")
FocusKeyPR("Key_Down" "")
FocusKeyPR("Key_Down" "")
FocusKeyPR("Key_Return" "\r")
CheckFocusWidget("window1.frame1.editorFrame.m_editorWidget")
CheckQuery("window1.frame1.editorFrame.m_editorWidget" "documentFileName" "create-tuple-class.py")

// Stop LSP #1.
Shortcut("window1.m_menuBar" "Alt+L")
KeyPress("window1.m_menuBar.lspMenu" "Key_P" "p")
CheckFocusWidget("window1.frame1.editorFrame.m_editorWidget")
WaitUntilCheckLabel(2000 "window1.m_statusArea.m_lspStatusWidget" "_")

// Open the dialog.
Shortcut("window1.m_menuBar" "Alt+L")
KeyPress("window1.m_menuBar.lspMenu" "Key_M" "m")
CheckFocusWidget("LSPServersDialog.m_table")

// Check the table.
CheckTableWidgetContents("LSPServersDialog.m_table" [
  ["local" "N/A" "C++" "0" "LSP_PS_CLIENT_INACTIVE"]
  ["local" re("editor/") "Python" "0" "LSP_PS_CLIENT_INACTIVE"]
  ["local" re("editor/smbase/") "Python" "0" "LSP_PS_CLIENT_INACTIVE"]
])

// Close the dialog.
FocusKeyPR("Key_Escape" "\u{1B}")
CheckFocusWidget("window1.frame1.editorFrame.m_editorWidget")

// EOF
