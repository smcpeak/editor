# apply-command-history.ev
# Check that command history is retained by Apply Command.

# Initial state.
CheckFocusWidget "window1.frame1.editorFrame.m_editorWidget"

# Open the dialog.
Shortcut "window1.m_menuBar.fileMenu.fileLaunchCommand" "Alt+R"
CheckFocusWidget "RunCommandDialog.m_prevCommandsListWidget"

#  When testing, the list is initially empty.
CheckListWidgetCount "RunCommandDialog.m_prevCommandsListWidget" "0"
CheckListWidgetContents "RunCommandDialog.m_prevCommandsListWidget" ""

# Run a command.
SetFocus "RunCommandDialog.m_newCommandLineEdit"
CheckFocusWidget "RunCommandDialog.m_newCommandLineEdit"
FocusKeySequence "true 1"
FocusKeyPR "Key_Return" "\r"

# Back in editor having run that command.
CheckFocusWidget "window1.frame1.editorFrame.m_editorWidget"
CheckFocusWindowTitleMatches "true 1"

# Open the dialog again.
Shortcut "window1.m_menuBar.fileMenu.fileLaunchCommand" "Alt+R"
CheckFocusWidget "RunCommandDialog.m_prevCommandsListWidget"

# The command should be in the list now.
CheckListWidgetCount "RunCommandDialog.m_prevCommandsListWidget" "1"
CheckListWidgetCurrentRow "RunCommandDialog.m_prevCommandsListWidget" "0"
CheckListWidgetContents "RunCommandDialog.m_prevCommandsListWidget" "true 1\n"

# Run another command.
SetFocus "RunCommandDialog.m_newCommandLineEdit"
CheckFocusWidget "RunCommandDialog.m_newCommandLineEdit"
FocusKeySequence "true 2"
FocusKeyPR "Key_Return" "\r"

# Back to editor.
CheckFocusWidget "window1.frame1.editorFrame.m_editorWidget"
CheckFocusWindowTitleMatches "true 2"

# Open the dialog again.
Shortcut "window1.m_menuBar.fileMenu.fileLaunchCommand" "Alt+R"
CheckFocusWidget "RunCommandDialog.m_prevCommandsListWidget"

# The list should have both entries, with the most recent selected.
CheckListWidgetCount "RunCommandDialog.m_prevCommandsListWidget" "2"
CheckListWidgetCurrentRow "RunCommandDialog.m_prevCommandsListWidget" "1"
CheckListWidgetContents "RunCommandDialog.m_prevCommandsListWidget" "true 1\ntrue 2\n"

# Arrow up to "true 1" and run it.
FocusKeyPR "Key_Up" ""
FocusKeyPR "Key_Return" "\r"

# Back in editor.
CheckFocusWidget "window1.frame1.editorFrame.m_editorWidget"
CheckFocusWindowTitleMatches "true 1"

# Open dialog.
Shortcut "window1.m_menuBar.fileMenu.fileLaunchCommand" "Alt+R"
CheckFocusWidget "RunCommandDialog.m_prevCommandsListWidget"

# List now has "true 1" selected.
CheckListWidgetCount "RunCommandDialog.m_prevCommandsListWidget" "2"
CheckListWidgetCurrentRow "RunCommandDialog.m_prevCommandsListWidget" "0"
CheckListWidgetContents "RunCommandDialog.m_prevCommandsListWidget" "true 1\ntrue 2\n"

# Arrow down to "true 2" and run it.
FocusKeyPR "Key_Down" ""
FocusKeyPR "Key_Return" "\r"

# Back in editor.
CheckFocusWidget "window1.frame1.editorFrame.m_editorWidget"
CheckFocusWindowTitleMatches "true 2"

# EOF
