// lsp-no-op-change.ev
// Test attempting to refresh diagnostics without any change.

CheckFocusWidget("window1.frame1.editorFrame.m_editorWidget")
CheckQuery("window1.frame1.editorFrame.m_editorWidget" "documentFileName" "language-test.cc")

// Start LSP and open the file.
CheckQuery("window1.frame1.editorFrame.m_editorWidget" "lspIsFakeServer" true)
Shortcut("window1.m_menuBar" "Alt+L")
KeyPress("window1.m_menuBar.lspMenu" "Key_A" "a")
Shortcut("window1.m_menuBar.lspMenu.lspOpenOrUpdateFile" "F7")

// Make a real change.
FocusKeySequence("diagnostic")

// Status widget should change to 3.
WaitUntilCheckLabel(2000 "window1.m_statusArea.m_lspStatusWidget" "3")

// Erase it.
FocusKeyPR("Shift+Key_Home" "")
FocusKeyPR("Key_Backspace" "\b")

// Widget back to 2.
WaitUntilCheckLabel(2000 "window1.m_statusArea.m_lspStatusWidget" "2")

// Now try to refresh with no change.
Shortcut("window1.m_menuBar.lspMenu.lspOpenOrUpdateFile" "F7")

// Crucially, this should get back to "2", rather than getting stuck at
// the "2*" state indicating we are awaiting diagnostics.
WaitUntilCheckLabel(2000 "window1.m_statusArea.m_lspStatusWidget" "2")

// EOF
